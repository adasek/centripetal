<!DOCTYPE html>
<html>
    <head>
        <title>Centripetal game</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" href="#">

        <style type="text/css">
            html,body {margin:0;
                       padding:0;
                       overflow: hidden;
                       background-color:#aaaaaa;
            }


        </style>

        <script type="text/javascript" src="bower_components/Matter/build/matter.js"></script>

        <script type="text/javascript" src="class/ball.js"></script>
        <script type="text/javascript" src="class/pylon.js"></script>

    </head>
    <body>

        <script type="text/javascript">
            // Matter.js module aliases
            var Engine = Matter.Engine,
                    World = Matter.World,
                    Bodies = Matter.Bodies;

            // create a Matter.js engine
            var engine = Engine.create(document.body, {
                render: {
                    options: {
                        width: 1024,
                        height: 1024
                    }
                }
            });

            var player = new Ball(0, 0, 50);
            var boxA = new Pylon(100, 200, 0);
            var boxB = new Pylon(400, 200, 0);
            var boxC = new Pylon(700, 200, 0);
            var boxD = new Pylon(100, 400, 0);
            var boxE = new Pylon(400, 400, 0);
            var boxF = new Pylon(700, 400, 0);


            // add all of the bodies to the world
            World.add(engine.world, [boxA.body, boxB.body, boxC.body, boxD.body, boxE.body, boxF.body, player.body]);





            var renderOptions = engine.render.options;
            renderOptions.wireframes = false;
            renderOptions.showAngleIndicator = false;

            window.onresize = function () {
                var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
                var h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

                //always fill screen with respecting aspectRatio
                var aspectRatio = 1; //w/h
                var sideH = Math.min(w * aspectRatio, h);
                var sideW = Math.min(w, h / aspectRatio);
                var side = Math.min(sideH, sideW);

                this.render.canvas.style.height = side + "px";
                this.render.canvas.style.width = side + "px";
                // this.render.options.width = document.documentElement.clientWidth;
                // this.render.options.height = document.documentElement.clientHeight;
            }.bind(engine);

            Matter.Events.on(engine, "beforeUpdate", function (event) {
                //console.log('afterUpdate');
                var engine = event.source;
                var world = engine.world;
                var gravity = world.gravity;
                var myBodies = Matter.Composite.allBodies(world);
                for (var i = 0; i < myBodies.length; i++) {
                    var body = myBodies[i];
                    if (typeof body.applyRopeGravity === "function" && body.onRopeGravity > 0) {
                        //Apply my custom function for any objects currently on rope
                        body.applyRopeGravity(
                                gravity.x * gravity.scale,
                                gravity.y * gravity.scale);
                    }
                }

            });


// run the engine
            Engine.run(engine);


            document.body.onkeyup = function (e) {
                if (e.keyCode === 32) {
                    player.toggleHook(engine.world);
                }
            };

        </script>
    </body>
</html>
